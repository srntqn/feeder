apiVersion: apps/v1
kind: Deployment
metadata:
  name: image-flow
spec:
  selector:
    matchLabels:
      app: image-flow
  template:
    metadata:
      labels:
        app: image-flow
    spec:
      containers:
      - name: image-flow
        image: image-flow
        resources:
          limits:
            memory: "128Mi"
            cpu: "500m"
        env:
        - name: app
          value: docker-py
        - name: docker_user
          valueFrom:
            secretKeyRef:
              name: docker-secret
              key: docker_user 
        - name: docker_password
          valueFrom:
            secretKeyRef:
              name: docker-secret
              key: docker_password
        volumeMounts:
        - mountPath: /var/run/docker.sock
          name: docker-socket-volume
        securityContext:
          privileged: true
      volumes:
      - name: docker-socket-volume
        hostPath:
          path: /var/run/docker.sock
          type: File